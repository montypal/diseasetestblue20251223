<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Probability Trainer</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; color: #333; padding: 20px; }
        .container { max-width: 650px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; margin-bottom: 20px; padding-bottom: 10px; }
        .score-box { background: #3498db; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        .scenario { font-size: 1.1em; background: #f9f9f9; padding: 20px; border-left: 5px solid #3498db; margin-bottom: 20px; }
        input { padding: 12px; border: 1px solid #ccc; border-radius: 5px; width: 80px; font-size: 16px; }
        button { padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-submit { background-color: #3498db; color: white; }
        .btn-next { background-color: #2ecc71; color: white; display: none; }
        #feedback { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; line-height: 1.4; }
        .correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .card { background: #eee; padding: 20px; border-radius: 10px; text-align: center; }
    </style>
</head>
<body>

<div class="container" id="game-container">
    <div class="header">
        <span id="dr-display" style="font-weight: bold; color: #2c3e50;">Dr. Grace</span>
        <div class="score-box">Score: <span id="score">0</span> / <span id="attempted">0</span></div>
    </div>

    <div id="scenario-text" class="scenario"></div>

    <div id="input-area">
        <input type="number" id="user-input" step="0.1" placeholder="0.0"> % 
        <button class="btn-submit" id="submit-btn" onclick="processResponse()">Submit Answer</button>
    </div>
    
    <button class="btn-next" id="next-btn" onclick="nextQuestion()">Next Question &rarr;</button>

    <div id="feedback"></div>
</div>

<script>
    let currentCount = 0;
    let score = 0;
    let lastCorrect = 0;
    
    const diseases = ["Hypothyroidism", "Lyme Disease", "Celiac Disease", "Early Diabetes", "Hypertension", "Anemia", "Sleep Apnea", "Glaucoma"];
    const names = ["Mr. Walsh", "Ms. Rodriguez", "A 40-year-old patient", "James", "Sarah", "Mrs. Lee", "Robert", "Elena"];

    function generateData() {
        const prev = (Math.random() * (12 - 1) + 1).toFixed(1);
        const sens = (Math.random() * (99 - 85) + 85).toFixed(0);
        const spec = (Math.random() * (99 - 80) + 80).toFixed(0);
        
        const p_d = prev / 100;
        const p_pos_d = sens / 100;
        const p_fp = (100 - spec) / 100;
        
        // Bayes Calculation
        const prob = (p_pos_d * p_d) / ((p_pos_d * p_d) + (p_fp * (1 - p_d)));
        return { prev, sens, spec, prob: (prob * 100).toFixed(2) };
    }

    let currentData = generateData();

    function updateUI() {
        if (currentCount >= 60) {
            showFinalScore();
            return;
        }
        
        const dr = (currentCount % 2 === 0) ? "Dr. Grace" : "Dr. Aarav";
        const patient = names[Math.floor(Math.random() * names.length)];
        const disease = diseases[Math.floor(Math.random() * diseases.length)];
        
        document.getElementById('dr-display').innerText = dr;
        document.getElementById('scenario-text').innerHTML = `
            ${dr} is testing <strong>${patient}</strong> for <strong>${disease}</strong>.<br><br>
            - Prevalence: <strong>${currentData.prev}%</strong><br>
            - Sensitivity: <strong>${currentData.sens}%</strong><br>
            - Specificity: <strong>${currentData.spec}%</strong><br><br>
            The test is <strong>Positive</strong>. What is the probability of disease?
        `;
        document.getElementById('user-input').value = "";
        document.getElementById('feedback').style.display = "none";
        document.getElementById('submit-btn').style.display = "inline-block";
        document.getElementById('next-btn').style.display = "none";
    }

    function processResponse() {
        const userVal = parseFloat(document.getElementById('user-input').value);
        const feedback = document.getElementById('feedback');
        currentCount++;
        
        feedback.style.display = "block";
        document.getElementById('submit-btn').style.display = "none";
        document.getElementById('next-btn').style.display = "inline-block";

        const isCorrect = Math.abs(userVal - currentData.prob) < 0.6;
        
        if (isCorrect) {
            score++;
            feedback.className = "correct";
            feedback.innerHTML = `<strong>Correct!</strong> The probability is ${currentData.prob}%.`;
        } else {
            feedback.className = "incorrect";
            feedback.innerHTML = `<strong>Incorrect.</strong> The correct probability was ${currentData.prob}%.<br>
            <small>Calculation: (${currentData.sens/100} * ${currentData.prev/100}) / [(${currentData.sens/100} * ${currentData.prev/100}) + (${(100-currentData.spec)/100} * ${(100-currentData.prev)/100})]</small>`;
        }
        
        document.getElementById('score').innerText = score;
        document.getElementById('attempted').innerText = currentCount;
    }

    function nextQuestion() {
        currentData = generateData();
        updateUI();
    }

    function showFinalScore() {
        const pct = ((score / 60) * 100).toFixed(1);
        document.getElementById('game-container').innerHTML = `
            <h2>Final Results</h2>
            <div class="summary-grid">
                <div class="card"><strong>Total Correct</strong><br><span style="font-size:2em">${score}/60</span></div>
                <div class="card"><strong>Accuracy</strong><br><span style="font-size:2em">${pct}%</span></div>
            </div>
            <br><button onclick="location.reload()" class="btn-submit">Restart Training</button>
        `;
    }

    updateUI();
</script>

</body>
</html>
